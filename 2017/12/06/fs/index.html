<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge, chrome=1"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="keywords" content="river,前端,设计,前端开发,用户体验,设计,frontend,design,nodejs,JavaScript"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><link rel="stylesheet" href="/css/style.css"><link rel="icon" href="/images/favicon.ico"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><title>Node基础模块-fs文件系统</title><body><div class="container"><div class="nav"><ul><li class="item"><a href="/">主页</a></li><li class="item"><a href="/archives">归档</a></li><li class="item"><a href="/about/">关于</a></li></ul></div><article><header><h1 class="title">Node基础模块-fs文件系统</h1><i class="icon-calendar"></i><span>2017.12.06</span></header><div class="content"><p>前段时间写cli辅助工具，里面很大部分涉及到文件的操作。在node中，我们可以使用基础的fs模块读写文件，通过 require(‘fs’) 使用该模块。 所有的方法都有异步和同步的形式。</p>
<a id="more"></a>
<h3 id="fs-readFile"><a href="#fs-readFile" class="headerlink" title="fs.readFile"></a>fs.readFile</h3><p>参数：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 异步读文件。</span></span><br><span class="line"><span class="comment"> * @param &#123;String&#125; filename 文件名</span></span><br><span class="line"><span class="comment"> * @param &#123;String&#125; [encoding] 编码，如果指定encoding，data是一个解析后的字符串，否则将会以Buffer形式表示的二进制数据。</span></span><br><span class="line"><span class="comment"> * @param &#123;Function&#125; callback 回调方法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">fs.readFile(filename,[encoding],[callback(error,data)]</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 同步读文件。</span></span><br><span class="line"><span class="comment"> * @param &#123;String&#125; filename 文件名</span></span><br><span class="line"><span class="comment"> * @param &#123;String&#125; [encoding] 编码，如果指定encoding，data是一个解析后的字符串，否则将会以Buffer形式表示的二进制数据。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">fs.readFileSync(filename, [encoding])</span><br></pre></td></tr></table></figure></p>
<p>实例：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 文件同步读取 */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 没有声明encoding，所以返回的是buffer（二进制数据）</span></span><br><span class="line"><span class="keyword">var</span> bufferStr = fs.readFileSync(<span class="string">'test.txt'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(bufferStr);  <span class="comment">// 输出 &lt;Buffer 68 65 6c 6c 6f 0a&gt;</span></span><br><span class="line"><span class="comment">// 声明了encoding，所以返回的是普通字符串</span></span><br><span class="line"><span class="keyword">var</span> str = fs.readFileSync(<span class="string">'test.txt'</span>, &#123;</span><br><span class="line">    encoding: <span class="string">'utf-8'</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(str);  <span class="comment">// 输出 hello</span></span><br><span class="line"><span class="comment">// 文件读取异常处理：通过try、catch</span></span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> errStr = fs.readFileSync(<span class="string">'noneExist.txt'</span>);</span><br><span class="line">&#125;<span class="keyword">catch</span>(err)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err.message);  <span class="comment">// 输出 ENOENT, no such file or directory 'noneExist.txt'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 文件异步读取 */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 无声明encoding</span></span><br><span class="line">fs.readFile(<span class="string">'test.txt'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, data</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(err)&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'文件读取失败'</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(data);  <span class="comment">// 输出 &lt;Buffer 68 65 6c 6c 6f 0a&gt;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 声明了encoding</span></span><br><span class="line">fs.readFile(<span class="string">'test.txt'</span>, &#123;<span class="attr">encoding</span>: <span class="string">'utf-8'</span>&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err, data</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(err)&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'文件读取失败'</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(data);  <span class="comment">// 输出 hello</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 异常处理</span></span><br><span class="line">fs.readFile(<span class="string">'noneExist.txt'</span>, &#123;<span class="attr">encoding</span>: <span class="string">'utf-8'</span>&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err, data</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(err)&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'文件读取失败'</span>);  <span class="comment">// 输出 文件读取失败</span></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<h3 id="fs-writeFile"><a href="#fs-writeFile" class="headerlink" title="fs.writeFile"></a>fs.writeFile</h3><p>参数：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 往文件里异步写数据，写入的内容可以是字符串，也可以是二进制数据。</span></span><br><span class="line"><span class="comment"> * 如果文件不存在，则创建；如果文件已存在，那么内容会被覆盖</span></span><br><span class="line"><span class="comment"> * @param &#123;String&#125; filename 文件名</span></span><br><span class="line"><span class="comment"> * @param &#123;String|Buffer&#125; data 要往文件里写的内容，可以是字符串，也可以是二进制数据。当为二进制数据时候，options.encoding 会被忽略</span></span><br><span class="line"><span class="comment"> * @param &#123;Object&#125; [options]</span></span><br><span class="line"><span class="comment"> * @param &#123;String&#125; options.encoding 编码，默认是utf8</span></span><br><span class="line"><span class="comment"> * @param &#123;Number&#125; options.mode=438 模式</span></span><br><span class="line"><span class="comment"> * @param &#123;String&#125; options.flag=w 写文件的模式</span></span><br><span class="line"><span class="comment"> * @param &#123;Function&#125; callback 回调方法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">fs.writeFile(filename, data, [options], callback)</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 往文件里同步写数据，写入的内容可以是字符串，也可以是二进制数据。</span></span><br><span class="line"><span class="comment"> * 如果文件不存在，则创建；如果文件已存在，那么内容会被覆盖</span></span><br><span class="line"><span class="comment"> * @param &#123;String&#125; filename 文件名</span></span><br><span class="line"><span class="comment"> * @param &#123;String|Buffer&#125; data 要往文件里写的内容，可以是字符串，也可以是二进制数据。当为二进制数据时候，options.encoding 会被忽略</span></span><br><span class="line"><span class="comment"> * @param &#123;Object&#125; [options]</span></span><br><span class="line"><span class="comment"> * @param &#123;String&#125; options.encoding 编码，默认是utf8</span></span><br><span class="line"><span class="comment"> * @param &#123;Number&#125; options.mode=438 模式</span></span><br><span class="line"><span class="comment"> * @param &#123;String&#125; options.flag=w 写文件的模式</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">fs.writeFileSync(filename, data, [options])</span><br></pre></td></tr></table></figure></p>
<p>实例:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/** 往不存在的文件里写内容 */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> noneExistFileName = [<span class="string">'async_create.'</span>, <span class="keyword">new</span> <span class="built_in">Date</span>()<span class="number">-0</span>, <span class="string">'.txt'</span>].join(<span class="string">''</span>);</span><br><span class="line">fs.writeFile(noneExistFileName, <span class="string">'文件不存在，则创建'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</span><br><span class="line">    <span class="built_in">console</span>.log(noneExistFileName+<span class="string">'不存在，被创建了！'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 往存在的文件里写内容 */</span></span><br><span class="line"></span><br><span class="line">fs.writeFile(<span class="string">'async_exists.txt'</span>, <span class="string">'文件已存在，则覆盖内容 -- '</span>+(<span class="keyword">new</span> <span class="built_in">Date</span>()<span class="number">-0</span>), <span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'exists.txt已存在，内容被覆盖！'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 往已经存在的文件里追加内容 */</span></span><br><span class="line"></span><br><span class="line">fs.writeFile(<span class="string">'async_add.txt'</span>, <span class="string">'\n文件已存在，并追加内容 -- '</span>+(<span class="keyword">new</span> <span class="built_in">Date</span>()<span class="number">-0</span>), &#123;</span><br><span class="line">    flag: <span class="string">'a'</span></span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'exists.txt已存在，内容被覆盖！'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<h3 id="异步还是同步"><a href="#异步还是同步" class="headerlink" title="异步还是同步"></a>异步还是同步</h3><p>由于Node环境执行的JavaScript代码是服务器端代码，绝大部分需要在服务器运行期反复执行业务逻辑的代码，必须使用异步代码，否则，同步代码在执行时期，服务器将停止响应。</p>
<p>开发命令行工具的时候，要读取配置文件，或者结束时需要写入到状态文件时，使用同步代码，因为很多文件都是先读取再做写操作。</p>
</div></article></div></body></head></html>