<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge, chrome=1"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="keywords" content="river,前端,设计,前端开发,用户体验,设计,frontend,design,nodejs,JavaScript"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><link rel="stylesheet" href="/css/style.css"><link rel="icon" href="/source/images/favicon.ico"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><title>JavaScript 实现监听数组的变化</title><body><div class="container"><div class="nav"><ul><li class="item"><a href="/">主页</a></li><li class="item"><a href="/archives">归档</a></li><li class="item"><a href="/about/">关于</a></li></ul></div><article><header><h1 class="title">JavaScript 实现监听数组的变化</h1><i class="icon-calendar"></i><span>2017.06.20</span></header><div class="content"><p>假如我们往对象中添加一组数组，如何监听数组的变化呢？<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">var data = &#123;</span><br><span class="line">     user: &#123;</span><br><span class="line">       name: &quot;xiaohe&quot;,</span><br><span class="line">       age: &quot;18&quot;</span><br><span class="line">     &#125;,</span><br><span class="line">     address: &#123;</span><br><span class="line">       city: &quot;gz&quot;</span><br><span class="line">     &#125;,</span><br><span class="line">     phone:[123,456,789]</span><br><span class="line">   &#125;;</span><br></pre></td></tr></table></figure></p>
<p>操作的操作数组的方法有很多，这些方法如下：</p>
<ul>
<li>push()</li>
<li>pop()</li>
<li>shift()</li>
<li>unshift()</li>
<li>splice()</li>
<li>sort()</li>
<li>reverse()</li>
</ul>
<p>那我们可以重写这些数组方法，实现我们监听数组的目的，当然这是个笨而庞大的工作，那有没有更好的方法呢？</p>
<p>我们可以重新包装数据中数组的push、pop等常用方法：</p>
<ul>
<li>当我们创建一个数组 var arr = [] 时，数组实例的proto属性，是Array.prototype的引用</li>
<li>在数组的原型方法 Array.prototype 和 数组 arr 之间添加了一环 fakePrototype (假的原型)，通过 proto 连接在一起。</li>
</ul>
<p>核心代码:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">var aryMethods = [&apos;push&apos;, &apos;pop&apos;, &apos;shift&apos;, &apos;unshift&apos;, &apos;splice&apos;, &apos;sort&apos;, &apos;reverse&apos;];</span><br><span class="line">var arrayAugmentations = [];</span><br><span class="line"></span><br><span class="line">aryMethods.forEach((method)=&gt; &#123;</span><br><span class="line"></span><br><span class="line">    // 这里是原生Array的原型方法</span><br><span class="line">    let original = Array.prototype[method];</span><br><span class="line"></span><br><span class="line">    arrayAugmentations[method] = function () &#123;</span><br><span class="line">        console.log(&apos;我被改变啦!&apos;);</span><br><span class="line"></span><br><span class="line">        // 调用对应的原生方法并返回结果</span><br><span class="line">        return original.apply(this, arguments);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">var list = [];</span><br><span class="line">list.__proto__ = arrayAugmentations;</span><br><span class="line">list.push(&apos;d&apos;);  // 我被改变啦！ 4</span><br></pre></td></tr></table></figure></div></article></div></body></head></html>